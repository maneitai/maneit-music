$root = "F:\musikk\musikk"
$outFile = Join-Path $root "tracks.json"
$baseUrl = "https://musikk.maneit.no/music"

function TitleFromBaseName([string]$baseName) {
    $t = $baseName
    if ($t.StartsWith("iskald-")) { $t = $t.Substring(7) }
    if ($t.StartsWith("maneit-")) { $t = $t.Substring(7) }
    $t = $t -replace '-', ' '
    $ti = [System.Globalization.CultureInfo]::GetCultureInfo("en-US").TextInfo
    return $ti.ToTitleCase($t)
}

function BuildProject($id, $title, $folderName, $artist) {
    $folderPath = Join-Path $root $folderName
    $files = @()
    if (Test-Path $folderPath) {
        $files = Get-ChildItem -File -Path $folderPath -Filter "*.mp3" | Sort-Object Name
    }

    $tracks = @()
    foreach ($f in $files) {
        $tracks += [pscustomobject]@{
            title  = (TitleFromBaseName $f.BaseName)
            artist = $artist
            mp3    = "$baseUrl/$folderName/$($f.Name)"
        }
    }

    return [pscustomobject]@{
        id     = $id
        title  = $title
        tracks = $tracks
    }
}

$projects = @()
$projects += BuildProject -id "iskald_no" -title "ISKALD (NO)" -folderName "iskald_no" -artist "Iskald"
$projects += BuildProject -id "iskald_en" -title "ISKALD (EN)" -folderName "iskald_en" -artist "Iskald"

# Hvis du har Maneit-mappe lokalt og vil ha den med automatisk:
if (Test-Path (Join-Path $root "maneit")) {
    $projects += BuildProject -id "maneit" -title "MANEIT" -folderName "maneit" -artist "Maneit"
}

$outObj = [pscustomobject]@{
    version  = 1
    projects = $projects
}

$outJson = $outObj | ConvertTo-Json -Depth 10
Set-Content -LiteralPath $outFile -Value $outJson -Encoding UTF8

Write-Host "Wrote: $outFile"
$projects | ForEach-Object { Write-Host "$($_.id): $($_.tracks.Count) tracks" }
